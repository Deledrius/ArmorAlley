/*
                                         ████▙   ▀████▌████▙  ▀█████   █████▀ ▄██████▄ ▀████▌████▙         ████▙   ▀█████▀    ▀█████▀     ▀████▐███▋▀█████▀ ▀█████▀ TM
                        ▄██▀            ▕█████▏   ████▌ ████▌  ▐████▌  ████▌ ████▎▐███▊ ████▌ ████▌        █████▏   █████      █████       ████ ▝██▋ ▝████   ▐███▘
                      ▄█▀               ▐▐████▎   ████▌ ████▌   █████ ▌████▌▐███▊  ████▏████▌ ████▌       ▐▐████▎   █████      █████       ████   ▝▋  ▝███▙ ▗███▘
      ▄████▄▄▄▄▄▄▄▄▄ █▀▄▄▄▄▄▄▄▄▄▄▄      █▌████▋   ████▌▗████▘   ▌█████▌████▌████▊  ████▌████▌▗████▘       █▌████▋   █████      █████       ████ ▗█▌    ▝███▙▝█▘
                  ▄█████▄▄▄▄  ▀▀▀      ▐█▌▐████   ████▌████▘    ▌█████▌████▌████▊  ████▌████▌████▘       ▐█▌▐████   █████      █████       ████▐██▌     ▐████▌
  ▄          ▄████████████████▄        ██ ▄████▎  ████▌▝███▙    █▐████ ████▌████▊  ████▌████▌▝███▙       ██ ▄████▎  █████      █████       ████ ▝█▌     ▐████▌
  ██        ▀████████████████████▄    ▐█▌██████▌  ████▌ ████▌  ▕█ ███▌ ████▌▐███▊  ████ ████▌ ████▌     ▐█▌██████▌  █████    ▗▋█████    ▗▋ ████   ▗▋    ▐████▌
  ▀███     ▄██████████████████████    ███  ▐████  ████▌ ████▌▗▋▐█ ▐██  ████▌ ████▎▐███▊ ████▌ ████▌▗▋   ███  ▐████  █████  ▗██▌█████  ▗██▌ ████ ▗██▌    ▐████▌
   ████▄▄███████████████████████▀    ▄███▄ ▄████▌▄█████▄▀████▀▄██▄ █▌ ▄█████▄ ▀██████▀ ▄█████▄▀████▀   ▄███▄ ▄████▌▄█████▐████▌█████▌████▌▄████▐███▌   ▄██████▄
  ████████▀▀▀▀▀▀▀▀████▀█▀▀▀▀█▀
   ██▀              ██▘▘ ██▘▘

  ---------------------------------------------
  A R M O R  A L L E Y  ::  R E M A S T E R E D
  --------- 10th Anniversary Edition ----------

  A browser-based interpretation of the Macintosh + MS-DOS releases of Armor Alley.

  Game, overview, tutorials etc.
  https://armor-alley.net/

  Quick video overview (3m 45s)
  https://youtu.be/oYUCUvg02rY

  Source code:
  https://github.com/scottschiller/ArmorAlley/

  Original development and history (2013)
  https://www.schillmania.com/content/entries/2013/armor-alley-web-prototype/

  Original game Copyright (C) 1989 - 1991, Information Access Technologies.
  https://en.wikipedia.org/wiki/Armor_alley

  Images, text and other portions of the original game used with permission under an ISC license.
  Original sound effects could not be re-licensed; modern replacements used from freesound.org.

  New game provided under the Attribution-NonCommercial 3.0 Unported (CC BY-NC 3.0) License:
  https://creativecommons.org/licenses/by-nc/3.0/

  General disclaimer: This is a fun personal side project. The code could be tightened up a bit.

  This release:     V2.01.20230520
  Previous release: V2.0.20230501
  Original release: V1.0.20131031

  For revision history, see README.md and CHANGELOG.txt.

*/
:root {
  /* a bit of fun: calc() + var() for animations + transitions, for dynamic game speed. */
  --game-speed: 1;
  --gs-frac: calc(1 / var(--game-speed));
  --prefs-font-scale: 1.1;
  /* TODO: coordinate with view.js */
  --menu-scale: 2.75;
  --menu-chicago-scale: 2.75;
  --game-scale-transform: 1;
  /* "transform + zoom" (combined value, regardless of method applied) */
  --gs: var(--game-scale-transform);
  /* radar scale, multiplier for tz */
  --radar-scale: 1;
  --rs: calc(var(--gs) * var(--radar-scale));
}

@font-face {
  font-display: swap;
  /* https://fontsarena.com/sysfont-by-alina-sava/ (SIL Open Font License 1.1) */
  font-family: FA Sysfont C;
  font-style: normal;
  font-weight: 400;
  src: url(../font/sysfont/sysfont.woff2) format('woff2');
}

@font-face {
  font-family: 'Cheddar Gothic Stencil';
  src: url('../font/CheddarGothicStencil/CheddarGothicStencil-subset.woff2')
    format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

body:not(.loaded) * {
  /**
   * Evil trade-off.
   * Initially hide, to prevent CLS in terms of performance. https://web.dev/articles/cls
   */
  display: none;
}

body,
html {
  /* scroll aversion */
  background: #000;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  margin: 0;
  padding: 0;
}

body,
input {
  /* Classic Mac OS-style "chicago" by default, with an array of safe fallbacks. */
  font-family: FA Sysfont C, JetBrains Mono, Menlo, Monaco, SF Mono,
    Lucida Console, Terminal, monospace;
}

body {
  /* who knows, for IE */
  -ms-interpolation-mode: nearest-neighbor;
  /* font trickery */
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  color: #fff;
  /**
   * avoid smooth image resizing, keep things pixelated - like the original.
   * Firefox does a great job here; Safari is OK (though not pixel-sharp.)
   * Chrome + Safari may be worse when using -webkit-optimize-contrast vs. default.
   * https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering
   */
  image-rendering: optimizeQuality;
  /* deprecated. */
  image-rendering: -webkit-optimize-contrast;
  /* non-standard, but quite nice under Firefox */
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
  image-rendering: pixelated;
}

body.is_safari:not(.is-mobile) {
  /**
   * Safari seems to rasterize before transform()-based scaling of text and images,
   * so things are soft and blurry. So be it; optimize image quality, vs. pixelated.
   */
  image-rendering: optimizeQuality;
}

body.is_safari:not(.is-mobile) #player-status-bar,
body.is_safari:not(.is-mobile) .sprite {
  /* Safari: given rasterization, keep things pixelated and sharp for sprites. */
  image-rendering: pixelated;
}

body.game-started {
  -webkit-touch-callout: none;
  /* prevent pinch-to-zoom and scroll */
  touch-action: none;
  /* on mobile especially, aggressively disable selection. this is a game, not a document. ;) */
  -webkit-user-select: none;
  user-select: none;
}

body.prefs-modal-open #aa,
body.prefs-modal-open #game-menu-wrapper {
  /* prevent clicks on the battlefield and/or game menu. */
  pointer-events: none;
}

#aa {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  /* ../image/cursor-cross.png */
  cursor: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAFklEQVR4AWOgNvg/EjX9JxaPhh6lAAALMhTsTJ1lCQAAAABJRU5ErkJggg==);
}

body.demo #aa {
  cursor: url(../image/cursor-cross-grey.png), crosshair;
}

#radar,
#world,
.sprite {
  /* https://developer.mozilla.org/en-US/docs/Web/CSS/contain */
  contain: strict;
}

#battlefield > .sprite,
#radar > .sprite {
  /* hide all first-level sprites (but not sub-sprites) until first transform / position is set, prevent flicker at 0px/0px. */
  transform: translate(-100%, -100%);
}

#game-menu-wrapper.active.fade-out {
  pointer-events: none;
  filter: blur(8px);
  transform: scale3d(1.1, 1.1, 1);
  transform-origin: 50% 50%;
  transition: 0.75s ease-in-out;
  transition-property: filter, background-image, opacity, transform;
  transform: translate3d(-50%, -50%, 0) scale3d(1.1, 1.1, 1);
  opacity: 0;
}

body.auto-start #game-menu-wrapper.active.fade-out {
  transition-delay: 0.75s;
}

#mtv-bnb-in {
  background-position: 0 0;
  background-repeat: no-repeat;
  background-size: contain;
  width: 25%;
  height: 46%;
  top: -13%;
  left: 1.65%;
  opacity: 0;
  position: absolute;
  transition: opacity 0.25s ease-in;
  z-index: 10;
}

body.bnb #mtv-bnb-in {
  opacity: 0.9;
}

#bnb-vs {
  /* https://www.steamgriddb.com/game/5248723 */
  background-position: 50% 100%;
  background-repeat: no-repeat;
  background-size: contain;
  position: absolute;
  bottom: -1px;
  filter: drop-shadow(0 1px 0.5px rgba(0, 0, 0, 0.5));
  height: 98%;
  left: 0;
  opacity: 0;
  transition: opacity 0.25s ease-in;
  width: 100%;
}

body.bnb #bnb-vs,
body.bnb-preload #bnb-vs {
  background-image: url(../image/virtual_stupidity_steamgriddb.webp);
}

body.bnb #bnb-vs {
  opacity: 1;
}

body.bnb #mtv-bnb-in,
body.bnb-preload #mtv-bnb-in {
  background-image: url(../image/virtual_stupidity_overlay.webp);
}

#bnb-vs,
#mtv-bnb-in {
  image-rendering: optimizeQuality;
  image-rendering: -webkit-optimize-contrast;
}

body.is_safari #bnb-vs,
body.is_safari #mtv-bnb-in {
  /* Safari does better with this here, ironically, vs. optimize-contrast */
  image-rendering: optimizeQuality;
}

#game-menu-wrapper {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  /* this will be overridden for mobile, landscape */
  aspect-ratio: 1/1;
  /* always leave a little room */
  padding-left: 8px;
  padding-right: 8px;
  margin: 0 auto;
  box-sizing: border-box;
  display: grid;
  align-content: center;
  /* initial state */
  transform: scale3d(0.8, 0.8, 1) translate3d(-50%, -50%, 0);
  transform-origin: 0 0;
  filter: blur(8px);
  opacity: 0;
  z-index: 1;
}

#game-menu-wrapper.active {
  /* hat tip: https://cubic-bezier.com/#.57,.18,.3,1.15 */
  transition: 0.75s cubic-bezier(0.57, 0.18, 0.3, 1.15);
  transition-property: transform, opacity, filter;
  transform: scale3d(1, 1, 1) translate3d(-50%, -50%, 0);
  transform-origin: 0 0;
  filter: blur(0px);
  opacity: 1;
}

@media screen and (orientation: landscape) {
  /* TODO: review and fix. */
  body.is_iphone #funds {
    zoom: 1.6;
  }
}

@media screen and (max-height: 780px) and (orientation: landscape) {
  #game-menu-wrapper {
    /**
     * HACK: restrict the logo width on smaller (short) screens.
     * TODO: make the home screen more responsive to vertical height restrictions.
     */
    width: 155vh;
    margin-top: 0;
    min-width: 350px;
    max-width: 100vw;
  }

  body.is_iphone #logo {
    /* collapse logo border, save some vertical space */
    border-top-width: calc(2px * var(--menu-scale));
  }
}

#game-menu-wrapper .logo-wrapper-wrapper {
  position: relative;
  display: inline-block;
  width: 100%;
  padding-top: 1vh;
  padding-left: 8px;
  padding-right: 8px;
  box-sizing: border-box;
  /* classic trick... */
  text-align: center;
}

#game-menu-wrapper .logo-wrapper {
  position: relative;
  display: inline-block;
  width: 100%;
  margin: 0 auto;
  /* prevent bottom "r" from being clipped, ugh. */
  padding-bottom: calc(2px * var(--gs));
  /* offset the above. */
  margin-top: -calc(1px * var(--gs));
  overflow: hidden;
}

#game-menu-wrapper .logo-overlay,
#game-menu-wrapper .logo-overlay-cutout,
#game-menu-wrapper .logo-overlay-highlight,
#game-menu-wrapper .logo-overlay-shadow {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

#game-menu-wrapper .logo-overlay-cutout {
  mask-image: url(../image/armor-alley-wordmark-white.webp);
  -webkit-mask-image: url(../image/armor-alley-wordmark-white.webp);
  mask-size: contain;
  -webkit-mask-size: contain;
  mask-repeat: no-repeat;
  -webkit-mask-repeat: no-repeat;
  /* this affects how the highlight gradient blends with the logo */
  mix-blend-mode: overlay;
}

#game-menu-wrapper .logo-overlay-highlight {
  width: 33%;
  height: 150%;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0) 0,
    rgba(255, 255, 255, 0) 5%,
    rgba(255, 255, 255, 0.75) 35%,
    rgba(255, 255, 255, 0.75) 66%,
    rgba(255, 255, 255, 0) 95%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: translate3d(-100%, -14.5%, 0) rotate(15deg);
  animation: 10s ease-in-out 1s infinite glint;
}

body.auto-start #game-menu-wrapper .logo-overlay-highlight {
  animation-duration: 3.85s;
  animation-delay: 0.75s;
}

@keyframes glint {
  0% {
    transform: translate3d(-100%, -14.5%, 0) rotate(15deg);
  }

  25% {
    transform: translate3d(350%, -14.5%, 0) rotate(15deg);
  }

  /* stay until the end */
  100% {
    transform: translate3d(300%, -14.5%, 0) rotate(15deg);
  }
}

#start-game-button-mobile {
  display: none;
  margin: 0.65em auto 0;
  border-radius: 5px;
}

#game-menu-wrapper .logo-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  /* note height here, for animation offset / scaling purposes */
  height: 600%;
  /**
   * Tool with color smoothing, albeit one color at a time...
   * https://www.learnui.design/tools/gradient-generator.html
   * #a52a2a @ 0%
   * #ffa500 @ 16%
   * #ffff00 @ 32%
   * #dd3333 @ 48%
   * #ffa500 @ 67%
   * #008000 @ 83%
   * #a52a2a @ 100%
   */
  /* smoothened version of the above */
  background: linear-gradient(
    180deg,
    brown,
    #b13225,
    #bd3d20,
    #c94b1a,
    #d65c14,
    #e3710e,
    #f18907,
    orange,
    orange,
    #ffb200,
    #ffbf00,
    #fc0,
    #ffd800,
    #ffe500,
    #fff200,
    #ff0,
    #ff0,
    #fad708,
    #f5b30f,
    #f09316,
    #eb761e,
    #e65c25,
    #e2462c,
    #d33,
    #d33,
    #e23d2c,
    #e64925,
    #eb571e,
    #f06716,
    #f5790f,
    #fa8e08,
    orange,
    orange,
    #edc700,
    #d3db00,
    #9bc900,
    #6ab600,
    #40a400,
    #1c9200,
    green,
    green,
    #2a8704,
    #558e09,
    #81940e,
    #998614,
    #9e661b,
    #a24722,
    brown
  );
  animation: 20s ease-in-out infinite alternate logo-gradient;
}

@keyframes logo-gradient {
  0% {
    transform: translate3d(0, 0, 0);
  }

  100% {
    /* bottom-align, i.e., 100% minus a fraction of the full 600% height */
    transform: translate3d(0, calc(-100% + (100% * 1 / 6)), 0);
  }
}

#game-menu-wrapper .logo-overlay-shadow {
  background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 0,
      rgba(0, 0, 0, 0.15) 10%,
      rgba(0, 0, 0, 0) 25%,
      rgba(0, 0, 0, 0) 50%,
      rgba(0, 0, 0, 0.33) 75%,
      rgba(0, 0, 0, 0.25) 92.5%,
      rgba(0, 0, 0, 0.2) 98%,
      rgba(0, 0, 0, 0) 99%
    ),
    repeating-linear-gradient(
      33deg,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0) 1px,
      rgba(0, 0, 0, 0.2) 1px,
      rgba(0, 0, 0, 0.2) 1.5px,
      rgba(0, 0, 0, 0.2) 1.5px,
      rgba(0, 0, 0, 0) 2px
    );
}

#game-menu-wrapper .logo-overlay,
#logo,
#logo-image {
  image-rendering: auto;
  image-rendering: optimizequality;
}

#logo-image {
  display: block;
  width: 100%;
  visibility: hidden;
}

#logo {
  position: relative;
  margin: 0 auto;
  border-top: calc(6px * var(--menu-scale)) solid #444;
  padding-top: calc(3px * var(--menu-scale));
  padding-bottom: calc(3px * var(--menu-scale));
  transition: 0.75s cubic-bezier(0.57, 0.18, 0.3, 1.15);
  /* hat tip: https://cubic-bezier.com/#.57,.18,.3,1.15 */
  transition-property: transform, scale, opacity;
  z-index: 11;
  border-bottom: 1px solid #be7832;
  opacity: 0.9;
}

#logo h1 {
  /* hackish: hide text */
  font-size: 0px;
  color: transparent;
}

#logo h1,
body:not(.game-started) #mobile-controls {
  opacity: 0;
}

body:not(.game-started) #mobile-controls {
  pointer-events: none;
}

body:not(.game-started) #player-status-bar {
  /* hide, retaining layout */
  visibility: hidden;
}

#world.welcome #player-status-bar {
  opacity: 0;
}

#world.welcome #battlefield {
  opacity: 0;
  filter: blur(8px);
}

#world.welcome #mobile-controls,
#world.welcome #player-status-bar {
  filter: grayscale(1);
}

#battlefield,
body.game-started #mobile-controls,
body.game-started #player-status-bar {
  transition: 1s ease-in-out;
  transition-property: filter, opacity, transform;
}

#game-menu {
  position: relative;
  color: #ccc;
  display: none;
  font-size: calc(10px * var(--menu-scale));
  text-align: center;
  /* don't exceed the screen width (e.g., mobile phones in portrait mode.) */
  width: 100%;
}

#game-menu.visible {
  display: block;
}

body.auto-start #game-menu {
  display: none;
}

body.auto-start #game-description,
body.auto-start #game-menu-form {
  /* used when "auto-start" is specified, i.e., user playing campaign mode */
  display: none;
}

body.auto-start #game-subtitle {
  /* hackish: hide the text because it fades out rather quickly. */
  color: transparent;
}

body.auto-start.is-mobile.loaded #start-game-button-mobile {
  display: block;
  transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
}

body.game-started #start-game-button-mobile {
  transform: scale3d(1.2, 1.2, 1);
  transform-origin: 50% 50%;
  opacity: 0;
}

#game-menu button {
  border-radius: calc(2px * var(--menu-scale));
  background-clip: padding-box;
}

#game-menu h2 {
  position: relative;
  color: #e19632;
  font-size: calc(5.5px * var(--menu-chicago-scale));
  line-height: 175%;
  margin: calc(1.5px * var(--menu-chicago-scale)) 0px
    calc(2px * var(--menu-chicago-scale)) 0;
  font-weight: 400;
  text-overflow: ellipsis;
  overflow: hidden;
  /* ensure this clips the BnB overlay, when showing */
  z-index: 10;
}

#game-menu label {
  cursor: pointer;
  display: inline-block;
  padding: calc(4px * var(--menu-scale));
  padding-left: calc(5px * var(--menu-scale));
  padding-right: calc(5px * var(--menu-scale));
  border-left: 0.5px solid #ccc;
  border-right: 0.5px solid #ccc;
  position: relative;
  vertical-align: middle;
}

#game-menu label:first-of-type {
  border-left: none;
}

#game-menu label:last-of-type {
  border-right: none;
}

#checkbox-vs:hover,
#game-menu label:hover,
#game_level:hover {
  background-color: rgba(0, 128, 0, 0.5);
  color: #fff !important;
}

#game-type-list:hover,
#game-type-list:hover input[type='radio'] {
  color: #fff !important;
}

#game-menu select {
  --bg-size: calc(8px * var(--menu-scale));
  appearance: none;
  background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='%23ffffff'><polygon points='0,0 100,0 50,50'/></svg>")
    no-repeat padding-box;
  background-position: calc(100% - var(--bg-size)) 70%;
  background-size: var(--bg-size);
  border-radius: calc(2px * var(--menu-scale));
  text-indent: calc(4px * var(--menu-scale));
}

body.is_safari #game-menu select:active,
body.is_safari #game-menu select:focus {
  /* evil, I know. */
  outline: 0;
}

#game-menu select {
  --bg-size: calc(6px * var(--menu-scale));
  --text-indent: calc(3px * var(--menu-scale));
  background-position: calc(100% - var(--text-indent) * 1.65) 65%;
  background-size: calc(var(--bg-size));
  border-radius: calc(2px * var(--menu-scale));
  min-width: 7em;
  font-size: calc(11px * var(--menu-scale));
  font-weight: 400;
  /* look similar to buttons */
  min-height: calc(18px * var(--menu-scale));
  /* vertical align shenanigans */
  text-indent: var(--text-indent);
  /* new ish */
  font-family: 'Cheddar Gothic Stencil';
  height: calc(18px * var(--menu-scale));
  text-indent: var(--text-indent);
  padding: 0;
}

body.is_mac:not(.is_safari):not(.is_firefox) #game-menu select:active {
  /* WHAT A HACK. Prevent massive text size in Chrome on macOS. */
  /* set a value relative to menu scaling, so text is reasonably fixed-size. */
  --scale: calc(1.5 * (1 / var(--menu-scale)));
  zoom: var(--scale);
  /* in case browsers use the color for the drop-down, make it black to be safe. */
  color: #000;
}

body.is_safari.is_iphone #game-menu select {
  /* stubborn iOS Safari */
  /* height: calc(20.5px * var(--menu-scale)); */
  height: calc(18.33px * var(--menu-scale));
}

body.is_safari:not(.is-mobile):not(.is_firefox) #game-menu select:active {
  /* Safari-specific: adjust zoom, but retain sizing of element. */
  /* set a value relative to menu scaling, so text is reasonably fixed-size. */
  --scale: calc(1.75 * (1 / var(--menu-scale)));
  zoom: var(--scale);
  font-family: FA Sysfont C, courier, sans-serif;
  /* note slight padding on width. */
  min-width: calc(7em * 1 / var(--scale) + 3px);
  height: calc(0.925em * var(--menu-scale));
  /* hide UI */
  text-indent: -100%;
  background-image: none !important;
}

body.is_safari.is-mobile #game-menu-wrapper button.game-start .emoji-text {
  /* ugh. */
  vertical-align: bottom;
}

#game-menu select optgroup,
#game-menu select option,
#game-menu select:active option,
#game-menu select:focus option {
  /* Font sizing (if not more) works in Firefox on Mac and Windows, and maybe also Edge and Chrome on Windows: Reset drop-down size. */
  font-family: FA Sysfont C, courier, sans-serif;
  font-size: 13px;
  /* some browsers might render the list in white, poorly, against a light background? */
  color: #000;
  background-color: #fff;
}

#game-menu label:hover {
  border-color: #fff;
}

#game-menu .cta,
.generic-cta {
  background-color: rgba(0, 102, 0, 0.5);
  border: 1px solid green;
  box-sizing: border-box;
  color: #ccc;
  cursor: pointer;
  display: inline-block;
  font-size: 1em;
  line-height: 1.5em;
  padding-top: 4px;
  padding-left: 0;
  text-decoration: none;
}

.generic-cta {
  border-radius: 2px;
}

#game-menu label.cta[for='checkbox-vs'] {
  /* BnB-specific: vertical alignment */
  padding-right: 0;
  top: calc(2px * var(--menu-scale));
  /* prevent top shift from pushing row down */
  padding-bottom: 0;
}

#game-menu .cta-radio:first-of-type {
  margin-left: 0;
}

#game-menu .cta:focus,
#game-menu .cta:hover,
.generic-cta:focus,
.generic-cta:hover {
  background-color: rgba(0, 153, 0, 0.75);
  color: #fff;
  outline: 0;
}

#game-menu form {
  display: block;
  width: 100%;
  /* collapse whitespace */
  font-size: 0px;
}

#game-menu form input {
  cursor: pointer;
}

#game-menu form input[type='radio'] {
  /* remove standard background appearance */
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  /* background-color only for content */
  background-clip: content-box;
  background-color: transparent;
  border: 2px solid #ccc;
  border-radius: 50%;
  /* create custom radio button appearance */
  display: inline-block;
  width: calc(9px * var(--menu-scale));
  height: calc(9px * var(--menu-scale));
  margin: 0;
  padding: calc(1.5px * var(--menu-scale));
  position: relative;
  vertical-align: middle;
  /* offset border, and/or padding for centering? :X */
  margin-top: calc(-1px * var(--menu-scale));
}

body:not(.is-mobile) #game-type-list .emoji-text {
  position: relative;
  top: calc(0.35px * var(--menu-scale));
}

body.is_firefox #game-type-list .emoji-text {
  /* hack: push emoji down. */
  top: calc(0.7px * var(--menu-scale));
}

body.is_firefox #game-type-list label {
  /* hack: pull entire label up, vertical center. */
  position: relative;
  top: calc(-0.35px * var(--menu-scale));
}

#game-menu form input[type='radio']:checked {
  background-color: #fff;
}

#game-menu .cta-checkbox {
  background: 0 0;
  border: none;
  cursor: pointer;
  display: inline-block;
  position: relative;
  font-size: calc(10px * var(--menu-scale));
  vertical-align: top;
}

#game-menu .checkbox-wrapper {
  display: inline-block;
  margin-left: 0;
  vertical-align: top;
}

#game-menu .cta-checkbox input[type='checkbox'] {
  -webkit-appearance: none;
  appearance: none;
  border-radius: calc(2px * var(--menu-scale));
  background-clip: padding-box;
  color: currentColor;
  cursor: pointer;
  display: grid;
  margin: 0;
  place-content: center;
  width: calc(13px * var(--menu-scale));
  height: calc(13px * var(--menu-scale));
}

#game-menu .cta-checkbox input[type='checkbox']:before {
  position: absolute;
  top: calc(-0.67px * var(--menu-scale));
  left: calc(-0.55px * var(--menu-scale));
  background: 0 0;
  content: '🤘';
  height: 1em;
  width: 1em;
  visibility: hidden;
  font-size: calc(7px * var(--menu-scale));
  transform: translate3d(50%, 50%, 0);
}

body.is_iphone #game-menu .cta-checkbox input[type='checkbox']:before {
  /* Slightly smaller on iPhone. */
  font-size: calc(6px * var(--menu-scale));
}

#game-menu .cta-checkbox input[type='checkbox']:checked:before {
  visibility: visible;
}

#game-menu .cta-checkbox:hover {
  animation: none;
  background: 0 0;
}

#game-menu .emoji {
  display: inline-block;
  font-size: 1.25em;
  line-height: 1.25em;
  vertical-align: bottom;
}

#exit {
  display: none;
}

#exit.visible {
  display: inline;
}

#game-menu .cta:hover .emoji {
  filter: grayscale(0);
  opacity: 1;
}

#game-description {
  color: #ccc;
  font-size: calc(5px * var(--menu-chicago-scale));
  text-shadow: 0 0 2px #000;
  margin: 0 auto;
  margin-top: calc(2px * var(--menu-scale));
  /* reserve at least two lines */
  min-height: 3.15em;
}

#game-description span {
  display: inline-block;
  padding: calc(1px * var(--menu-chicago-scale))
    calc(2px * var(--menu-chicago-scale));
  border-radius: calc(2px * var(--menu-chicago-scale));
  background: rgba(0, 0, 0, 0.5);
}

#world-wrapper {
  /* mac style - and hide until game start */
  border-bottom: 2px solid #875400;
  font-size: 11px;
  height: 384px;
  left: 0;
  position: absolute;
  top: 0;
  /* for initial game fade */
  transition: filter 0.5s ease-in;
  width: 100%;
}

body.edit-mode #world-wrapper,
body.game-started #world-wrapper {
  transition: border 0.25s ease-in-out, filter 0.5s ease-in;
  border-bottom-color: #875400;
}

#game-status-bar {
  border: calc(1px * var(--gs)) solid #17a007;
  border-left: none;
  border-right: none;
}

#radar,
#radar-container {
  height: calc(32px * var(--gs));
}

#radar-container {
  background: #0e360e;
  position: relative;
}

@media (min-width: 1000px) and (min-height: 940px) {
  #radar-container {
    /* angled pinstripe pattern on larger screens - desktop, 12.9" iPad Pro and such. */
    background-image: repeating-linear-gradient(
      55deg,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0) 1.5px,
      rgba(0, 0, 0, 0.33) 1.5px,
      rgba(0, 0, 0, 0.33) 2.25px,
      rgba(0, 0, 0, 0.33) 2.25px,
      rgba(0, 0, 0, 0) 3px
    );
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
}

#radar {
  filter: none;
  overflow: hidden;
  transition: filter 0.75s ease-in-out, opacity 0.5s ease-in-out;
  opacity: 0;
  visibility: hidden; /* initially hide, to prevent visible opacity flash */
}

body.loaded #radar {
  opacity: 1;
  visibility: visible;
}

#radar,
#radar-jammed-overlay {
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

#radar-jammed-overlay {
  height: 100%;
  pointer-events: none;
  z-index: 11;
}

body.radar_enhanced_fx #radar-jammed-overlay {
  /* 'auto' gets somewhat smoother results in Firefox, less flickery-looking radar. */
  image-rendering: auto;
}

body.radar_enhanced_fx #radar-jammed-overlay.active,
body.radar_enhanced_fx #world-noise-overlay {
  /* Probably $$$ - only apply when active. */
  mix-blend-mode: soft-light;
}

#radar-jammed-overlay.active .noise,
#world-noise-overlay .noise {
  background: url(../image/noise-tv.webp) 0 0/128px 128px;
  bottom: 0;
  image-rendering: optimizeSpeed;
  left: -500px;
  opacity: 0;
  /**
   * "TV Static Noise Effect" - Ana Travas
   * https://codepen.io/anatravas/pen/vyOwOZ
   */
  position: absolute;
  right: 0;
  top: 0;
}

#radar-jammed-overlay.active .noise {
  /* default: lower "frame rate" on desktop; reduce compositing work? */
  animation: 1.6s steps(8) infinite both noise;
  opacity: 0.15;
}

/* note: radar jammed, plus game screen overlays */
body.radar_enhanced_fx #radar-jammed-overlay.active .noise,
body.radar_enhanced_fx #world-noise-overlay .noise {
  /* "enhanced" version - also composited with a blend-mode filter. */
  background-color: rgba(0, 0, 0, 0.25);
  animation: 1s steps(15) infinite both noise;
  opacity: 1;
}

/**
 * iOS GPUs should be able to handle full-screen overlays,
 * higher "frame rate", and filters for a more subtle effect.
 */
body.is_safari.game-paused.is-mobile #radar-jammed-overlay,
body.is_safari.game-paused.radar_enhanced_fx #radar-jammed-overlay {
  /**
   * 11/2023: Safari `mix-blend-mode` rendering issue(?)
   * Blend mode seems to fail when game is paused, and then resumed -
   * So, switch blend modes to force a re-render on resume.
   */
  mix-blend-mode: multiply !important;
}

#world-noise-overlay {
  position: absolute;
  /* radar offset */
  top: 8%;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 11;
  opacity: 0;
  pointer-events: none;
}

/* special case: home screen, game menu. */
body.radar_enhanced_fx #world-noise-overlay {
  opacity: 0.65;
  mix-blend-mode: soft-light;
}

body.radar_enhanced_fx.edit-mode #world-noise-overlay,
body.radar_enhanced_fx.game-started #world-noise-overlay {
  transition: opacity 0.75s ease-in-out;
  opacity: 0;
}

.tv-screen-container {
  position: absolute;
  overflow: hidden;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  max-width: 100vw;
  max-height: 100vh;
  aspect-ratio: 16/9;
  transform: translate3d(-50%, -50%, 0);
}

#tv-display {
  display: none;
  top: 50%;
  left: 50%;
  opacity: 0;
  pointer-events: none;
  position: absolute;
  /* center, and slightly smaller */
  --scale: calc(var(--gs) / 2);
  /* don't pull up a full half-height, leave room for announcement text etc. */
  transform: translate3d(-50%, -40%, 0) scale3d(var(--scale), var(--scale), 1);
  transition: 0.25s ease-in;
  transition-property: transform, opacity, filter, position;
  width: 409px;
  height: 320px;
}

body.bnb #tv-display {
  display: block;
}

body.bnb #tv-display.active {
  opacity: 1;
}

body.bnb #tv-display.disabled {
  opacity: 0 !important;
}

#tv-display #tv {
  /* https://pngtree.com/freepng/color-tube-television-screen-to-gold_7430214.html */
  background-size: contain;
  height: 320px;
  left: 0;
  position: absolute;
  top: 0;
  width: 409px;
  filter: drop-shadow(0 0 48px rgba(255, 255, 212, 0.33));
}

body.bnb #tv-display #tv,
body.bnb-preload #tv-display #tv {
  background-image: url(../image/pngtree.com_color_tv.webp);
}

body.bnb #tv-display.widescreen #tv {
  background: url(../image/pngtree.com_color_tv_widescreen.webp) 0 21.5px /
    contain no-repeat;
}

#tv-display video {
  height: 212px;
  left: 60px;
  position: absolute;
  top: 34px;
  width: 288px;
}

#tv-display.widescreen video {
  height: 214px;
  left: 59.5px;
  top: 33px;
  width: 290px;
}

#home-video-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  /* hide, for now. */
  opacity: 0;
}

#battlefield-overlay-left,
#battlefield-overlay-right {
  position: absolute;
  /* sit underneath fuel bar */
  top: 11%;
  bottom: 5.5%;
  width: 2%;
  z-index: 10;
  /* a rare occurrence - for iOS Safari so these render correctly on top. */
  transform: scale3d(1, 1, 1);
  pointer-events: none;
  transition: opacity 0.5s ease-in-out;
  opacity: 0;
}

body.game-started #battlefield-overlay-left,
body.game-started #battlefield-overlay-right {
  opacity: 1;
}

/* don't show these on realy small portrait displays. */
@media screen and (min-width: 640px) {
  #stars {
    /* hackish: offset because gradient overlay doesn't always seem to line up perfectly. */
    width: 99.5% !important;
  }

  body.game-started #battlefield-overlay-left {
    left: -1px;
    background: linear-gradient(90deg, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0));
  }

  body.game-started #battlefield-overlay-right {
    right: -1px;
    background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.95));
  }
}

body.loaded #home-video-wrapper {
  transition: opacity 0.5s ease-in-out;
  opacity: 1;
}

body.edit-mode #home-video-wrapper,
body.game-started #home-video-wrapper {
  opacity: 0;
  transition: opacity 0.25s ease-in-out;
}

#home-menu-video {
  position: absolute;
  top: 100%;
  left: 50%;
  width: auto;
  /* slightly over, vertical align tweak */
  height: 100.15%;
  aspect-ratio: 16/9;
  transform: translate3d(-50%, -100%, 0);
}

#home-menu-video video {
  /* prevent controls, hover + pop-out etc. */
  pointer-events: none;
}

body.game-started #world-wrapper.incoming-smart-missile {
  border-color: #fff;
}

body.demo #world-noise-overlay {
  /* smoother transition, maybe? */
  will-change: opacity;
}

#aa li,
#aa ul,
#game-menu li,
#game-menu ul {
  margin: 0;
  padding: 0;
}

#aa ul,
#game-menu ul {
  list-style-type: none;
}

#level-preview,
#top-bar {
  height: calc(88px * var(--gs));
}

#top-bar {
  contain: strict;
  z-index: 1;
  opacity: 0;
}

body.loaded #top-bar {
  transition: opacity 0.5s ease-in-out;
  opacity: 1;
}

body:not(.edit-mode) #top-bar {
  pointer-events: none;
}

#top-bar,
#world {
  left: 0;
  overflow: hidden;
  position: absolute;
  top: 0;
  width: 100%;
}

#world {
  height: 100%;
}

#battlefield {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
}

#radar .sprite {
  position: absolute;
  top: 0;
  left: 0;
  background: padding-box #17a007;
  border-color: #ccc;
  border-radius: calc(0.5px * var(--gs)) calc(0.5px * var(--gs)) 0 0;
  contain: strict;
  width: calc(3px * var(--rs));
  height: calc(3px * var(--gs));
  z-index: 2;
}

#radar .sprite.bottom-aligned {
  top: auto;
  bottom: 0;
}

#radar .sprite:not(.balloon) {
  /* a little extra, to avoid rounding errors. */
  padding-bottom: calc(0.5px * var(--rs));
}

/* .friendly? */
#radar .sprite:not(.helicopter) {
  /**
   * Performance observation -
   * `outline: 0.5px solid #000;` causes repaint in Chrome 110 on most radar items when gunfire happens.
   * filter: drop-shadow() seems to kill performance.
   * box-shadow seems to be OK.
   */
  box-shadow: 0 0 0 calc(0.5px * var(--gs)) #000;
}

#radar .sprite.enemy {
  background-color: #ccc;
}

#radar .sprite.bunker,
#radar .sprite.super-bunker {
  background-color: #17a007;
  border: calc(0.5px * var(--rs)) solid rgba(23, 160, 7, 0.75);
  /* account for bottom border? */
  margin-bottom: calc(-0.5px * var(--rs));
  /* round corners */
  border-radius: calc(1px * var(--gs)) calc(1px * var(--gs)) 0 0;
  height: calc(2px * var(--gs));
  padding: calc(0.5px * var(--rs));
  /* friendly */
  border: none !important;
}

#radar .sprite.super-bunker {
  height: calc(2.5px * var(--gs));
  width: calc(5px * var(--rs));
}

#radar .sprite.tank {
  height: calc(2.25px * var(--gs));
}

#radar .sprite.balloon {
  border-radius: calc(1.75px * var(--gs));
  /* special case left margin, for horizontal alignment over bunker */
  margin-left: calc(0.5px * var(--rs));
  height: calc(2px * var(--gs));
  width: calc(3px * var(--rs));
}

#radar .sprite.balloon,
#radar .sprite.bunker.enemy,
#radar .sprite.parachute-infantry.enemy,
#radar .sprite.super-bunker.enemy {
  /* yellow-ish tinge */
  background-color: #9c9f09;
  border-color: #9c9f09;
}

#radar .sprite.balloon.friendly,
#radar .sprite.parachute-infantry.friendly {
  background-color: #17a007;
  border-color: rgba(23, 160, 7, 0.75);
}

#radar .sprite.bunker.enemy,
#radar .sprite.super-bunker.enemy {
  border-color: rgba(156, 159, 9, 0.75) rgba(156, 159, 9, 0.75) #9c9f09;
}

#radar .sprite.end-bunker.neutral,
#radar .sprite.super-bunker.hostile {
  background-color: transparent;
  border-color: rgba(255, 255, 255, 0.35);
  border-bottom-color: transparent;
  background-image: url(../image/checkerboard-white-mask-50percent.png);
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  background-size: calc(32px * var(--gs));
  /* hackish: push the border down further */
  padding-bottom: calc(1px * var(--gs));
}

#radar .sprite.cloud1,
#radar .sprite.cloud2,
#radar .sprite.cloud3 {
  height: calc(2px * var(--gs));
  /* hackish: position offset. */
  top: calc(2px * var(--gs));
  background-color: transparent;
  background-image: repeating-linear-gradient(
    -55deg,
    rgba(255, 255, 255, 0),
    rgba(255, 255, 255, 0) 0.5px,
    rgba(255, 255, 255, 0.2) 0.5px,
    rgba(255, 255, 255, 0.2) 0.75px,
    rgba(255, 255, 255, 0.2) 0.75px,
    rgba(255, 255, 255, 0) 1px
  );
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  border: calc(0.5px * var(--gs)) solid rgba(255, 255, 255, 0.15);
  border-radius: calc(2px * var(--gs));
  box-shadow: none;
  filter: none;
}

#radar .sprite.cloud1 {
  width: calc(12px * var(--rs));
}

#radar .sprite.cloud2,
#radar .sprite.cloud3 {
  width: calc(14px * var(--rs));
}

#radar .sprite.landing-pad {
  top: auto;
  bottom: 0;
  width: calc(8px * var(--rs));
  height: calc(2px * var(--gs));
  /* green "U"-shape image */
  background-color: transparent;
  background-image: url(data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAYAAABllJ3tAAAAFUlEQVR4AWMQX8D+nwE7AMuBCXwYAIdBEWNHOYOnAAAAAElFTkSuQmCC);
  background-position: 50% calc(1px * var(--gs));
  background-size: contain;
  background-repeat: no-repeat;
  image-rendering: pixelated;
  box-shadow: none;
  filter: drop-shadow(0px -1px 1px #000);
  z-index: 0;
}

#radar .sprite.landing-pad.enemy {
  /* #ccc "U"-shape image */
  background-image: url(data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAYAAABllJ3tAAAAFUlEQVR4AWM4ePDgfwbsACwHJvBhAO1MIJVMk7QUAAAAAElFTkSuQmCC);
}

#radar .sprite.smart-missile {
  border-radius: 100%;
  bottom: auto;
  height: calc(1.25px * var(--gs));
  border-radius: calc(1.25px * var(--gs));
  left: 0;
  margin-top: calc(0.25px * var(--gs));
  outline: 0;
  position: absolute;
  top: auto;
  width: calc(3px * var(--rs));
  will-change: transform;
}

#radar .sprite.smart-missile.enemy {
  background-color: red;
}

#radar .sprite.helicopter {
  background-color: transparent;
  --border: calc(2.5px * var(--gs));
  border-bottom: var(--border) solid transparent;
  border-left: var(--border) solid #17a007;
  border-top: var(--border) solid transparent;
  font-size: 0;
  height: 0;
  outline: 0;
  width: 0;
  z-index: 5; /* show above landing pads, etc. */
}

@media screen and (orientation: landscape) and (max-height: 480px) {
  #radar .sprite.helicopter {
    /* larger chopper on small screens in landscape, given the radar is quite small. */
    --border: calc(4px * var(--gs));
  }

  /* give everybody a vertical boost, per se. */
  #radar .sprite:not(.balloon) {
    padding-bottom: calc(1px * var(--rs));
  }

  #radar .sprite.balloon {
    padding-bottom: calc(0.75px * var(--rs));
  }
}

#radar .sprite.helicopter.local-player {
  animation: blink calc(0.5s * var(--gs-frac)) steps(1) infinite;
}

#radar .sprite.expired {
  /* gunfire, etc. */
  opacity: 0.4;
}

#radar .sprite.bomb {
  --width: calc(1.5px * var(--rs));
  --height: calc(1.5px * var(--gs));
  border-radius: 0 0 var(--width) var(--width);
  height: var(--height);
  width: var(--width);
}

#radar .sprite.bomb.enemy,
#radar .sprite.gunfire.enemy,
#radar .sprite.shrapnel,
#radar .sprite.shrapnel.enemy {
  background-color: red;
}

#radar .sprite.gunfire,
#radar .sprite.shrapnel {
  --one: calc(1px * var(--rs));
  border-radius: var(--one);
  contain-intrinsic-size: var(--one) var(--one);
  /* hackish repositioning fix */
  content-visibility: auto;
  height: calc(1px * var(--gs));
  width: var(--one);
}

#radar .sprite.missile-launcher,
#radar .sprite.van {
  height: calc(2px * var(--gs));
  width: calc(2px * var(--rs));
}

#radar .sprite.engineer,
#radar .sprite.infantry,
#radar .sprite.parachute-infantry {
  height: calc(2px * var(--gs));
  outline-width: calc(0.25px * var(--rs));
  width: calc(1px * var(--rs));
}

#radar .sprite.engineer {
  width: calc(0.75px * var(--rs));
}

#radar .sprite.parachute-infantry {
  /* hackish repositioning fix */
  margin-top: calc(1px * var(--gs));
  /* semi-circle */
  border: calc(1px * var(--rs)) solid rgba(23, 160, 7, 0.75);
  border-bottom: none;
  width: calc(0.5px * var(--rs));
  height: calc(0.25px * var(--gs));
  border-radius: 50% 50% 0 0;
  background: 0 0 !important;
}

#radar .sprite.parachute-infantry.enemy {
  border-color: #ccc;
}

#radar .sprite.base {
  height: calc(2px * var(--gs));
  width: calc(8px * var(--rs));
  --radius: calc(0.5px * var(--rs));
  border-radius: var(--radius) var(--radius) 0 0;
}

#radar .sprite.end-bunker {
  height: calc(2px * var(--gs));
  width: calc(3px * var(--rs));
  border-radius: calc(1px * var(--gs));
}

#radar .sprite.dying {
  animation: blink calc(0.25s * var(--gs-frac)) infinite;
}

#radar .sprite.dead {
  display: none;
  /* just in case */
  /* will-change: initial; */
  transform: none;
}

#bottom {
  position: absolute;
  height: calc(18px * var(--gs));
  box-sizing: border-box;
  color: #666;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 0;
}

#bottom,
#queue .queue-item {
  font-size: calc(7px * var(--gs));
}

#radar .sprite.helicopter.enemy {
  margin-left: calc(-0.5px * var(--rs));
  background-color: transparent;
  border: calc(2.5px * var(--gs)) solid transparent;
  border-right-color: #ccc;
}

#radar .sprite.turret {
  background-color: #17a007;
  width: calc(1px * var(--rs));
  height: calc(2px * var(--gs));
  margin-left: calc(-0.5px * var(--rs));
}

#radar .sprite.turret.enemy {
  background-color: #ccc;
}

/* scan nodes */
#battlefield .sprite.missile-launcher,
#battlefield .sprite.turret,
#radar .sprite.missile-launcher,
#radar .sprite.turret {
  /* allow nested .scan-mode to show */
  contain: unset;
  overflow: visible;
}

#radar .sprite.missile-launcher,
#radar .sprite.turret {
  /* ensure everything sits on top of scan nodes */
  z-index: 2;
}

#battlefield .scan-node,
#radar .scan-node {
  /* visual illustrations of "scanning range" for missile launchers + turrets. */
  position: absolute;
  top: 100%;
  left: 50%;
  width: 0;
  height: 0;
  transform: translate3d(-50%, -100%, 0);
  overflow: hidden;
  /* account for border */
  margin-left: -0.5px;
  background-color: rgb(0, 255, 0, 0.025);
  border: 0.5px solid rgba(0, 255, 0, 0.075);
  /* this will be set and updated via JS */
  border-radius: 100%;
  transition-duration: calc(1s * var(--gs-frac));
  transition-timing-function: ease-in-out;
  transition-property: opacity, background-color, border-color, width, height,
    transform;
  z-index: -2;
  pointer-events: none;
}

#radar .scan-node {
  border-width: calc(0.5px * var(--gs));
  margin-left: calc(-0.25px * var(--rs));
}

#radar .sprite.enemy .scan-node {
  background-color: rgb(255, 255, 255, 0.025);
  border-color: rgba(255, 255, 255, 0.05);
}

body:not(.game-started) .scan-node {
  /* no transitions while showing level previews */
  transition-duration: 0s !important;
}

#radar .sprite.turret.destroyed {
  /* faded green */
  background-color: rgba(23, 160, 7, 0.5);
}

#radar .sprite.turret.enemy.destroyed {
  /* #ccc at 50% */
  background-color: rgba(204, 204, 204, 0.5);
}

#battlefield .sprite.destroyed .scan-node,
#battlefield .sprite.exploding .scan-node,
#radar .sprite.destroyed .scan-node {
  transform: translate3d(-50%, -100%, 0) scale3d(0, 0, 1);
  transform-origin: 50% 100%;
  transition-duration: calc(1s * var(--gs-frac));
}

#help,
#game-paused,
#tutorial,
#tutorial-window,
#editor-window,
#editor-window-help {
  display: none;
}

body:not(.game-started) #funds,
body:not(.game-started) #game-tips {
  display: none;
}

#help {
  float: right;
  margin-left: 1em;
  margin-right: 1em;
  position: relative;
  white-space: nowrap;
}

#help.active,
body.network #help {
  display: inline-block;
}

body.network:not(.game-started) #help #game-options-link,
body.network:not(.game-started) #help .pipe {
  display: none;
}

#bnb-now-playing {
  display: none;
}

body:not(.game-started) #notification-toasts {
  /* initially, hide. */
  display: none;
}

#game-prefs-modal {
  position: absolute;
  display: none;
}

button {
  background: #fff;
  border: 0.25px solid #000;
  border-radius: 2px;
  color: #000;
  cursor: pointer;
  font-family: FA Sysfont C, courier, sans-serif;
  font-size: 7px;
  font-weight: 400;
  margin: 0 0.25rem 0 0;
  min-width: 1.75rem;
  padding: 0.5px 5px;
  position: relative;
}

button.primary {
  /* original button border, a little bigger */
  border-width: 0.5px;
  /* inner white, followed by outer black borders */
  box-shadow: 0 0 0 0.5px #fff, 0 0 0 2px #000;
  /**
   * Most, but not all browsers can do a double-border this way,
   * where the outline follows border-radius styling as well.
   * Guess who the exception is ... :D ... see the next rule.
   */
  outline: 0;
  /**
   * IRONY: Safari doesn't apply border-radius to outlines, but
   * everyone else does; and this is for the 68K classic mac UI.
   * So, we'll use box-shadow shenanigans. :P
   */
  outline-offset: 0.5px;
  /* Safari collapses buttons more than the others. :/ */
  padding: 0.5px 10px;
}

.mac-system-waiting {
  /**
   * Hat tip: https://impossiblue.github.io/log/150406/index.html
   */
  background-image: url(../image/apple-watch.gif);
  background-position: 50% 50%;
  background-size: 11px 16px;
  margin-bottom: -2.75px;
  padding-left: 1px;
  width: 11px;
  padding-right: 1px;
}

.mac-system-spinner,
.mac-system-waiting {
  background-repeat: no-repeat;
  display: inline-block;
  height: 16px;
}

.mac-system-spinner {
  background-image: url(../image/mac-system-spinner.gif);
  background-size: contain;
  margin-bottom: -1px;
  margin-right: 1px;
  /* Hat tip: https://apple.stackexchange.com/questions/407893/where-are-are-the-counting-hand-cursors-used-in-macos */
  width: 16px;
}

#lock-step-indicator {
  display: none;
}

/* game menu screen */
#checkbox-vs,
#game-menu button.large,
#game-menu select,
#game-type-list {
  background-color: rgba(0, 128, 0, 0.5);
  border: none;
}

#game-menu button.large,
#game-menu select {
  color: #eee;
}

#game-level-wrapper,
#game-type-list-wrapper {
  margin-bottom: calc(4px * var(--menu-scale));
}

#game-type-list-wrapper {
  position: relative;
  /* collapse whitespace */
  font-size: 0px;
  display: inline-block;
  vertical-align: bottom;
  margin-left: calc(4px * var(--menu-scale));
}

#game-type-list {
  border-radius: calc(2px * var(--menu-scale));
  background-clip: padding-box;
  overflow: hidden;
}

#game-type-list.disabled {
  opacity: 0.5;
  filter: grayscale(1);
}

#game-type-list li:not(:last-of-type) label {
  padding-left: calc(5px * var(--menu-scale));
  padding-right: calc(5px * var(--menu-scale));
}

#game-type-list li:not(:first-of-type):not(:last-of-type) label {
  border-left: 1px solid rgba(0, 0, 0, 0.5);
  border-right: 1px solid rgba(0, 0, 0, 0.5);
}

#game-type-list label {
  font-size: calc(10px * var(--menu-scale));
  line-height: calc(10px * var(--menu-scale));
}

#game-buttons {
  position: relative;
}

#game-buttons button {
  margin-right: calc(4px * var(--menu-scale));
}

#game-menu-wrapper button.large,
.generic-cta {
  color: #333;
  filter: drop-shadow(0 0 0 rgba(0, 0, 0, 0));
  font-size: calc(11px * var(--menu-scale));
  line-height: calc(11px * var(--menu-scale));
  padding: calc(4px * var(--menu-scale)) calc(6px * var(--menu-scale));
  vertical-align: middle;
}

#game-menu-wrapper button.game-start {
  font-family: 'Cheddar Gothic Stencil';
  font-size: calc(13.75px * var(--menu-scale));
  padding: calc(4px * var(--menu-scale));
}

#game-menu-wrapper button.game-start .emoji-text {
  position: relative;
  top: -0.1em;
}

#game-menu-wrapper button.large:hover {
  background-color: rgba(0, 255, 0, 0.5);
  filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.5));
}

#game-menu select:hover,
#game-type-list label:hover {
  background-color: rgba(0, 255, 0, 0.33);
  filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.5));
}

#game-menu input[type='checkbox']:hover {
  background-color: rgba(0, 255, 0, 0.5);
}

.generic-cta {
  font-size: 8px;
  padding: 2px 8px;
  line-height: 10px;
}

#game-menu-wrapper button.game-start,
.generic-cta {
  background: rgba(0, 255, 0, 0.5);
  border-color: transparent;
  color: #fff;
  text-shadow: 0.5px 0.5px rgba(0, 0, 0, 0.25);
}

#game-menu-wrapper button.large.game-start:hover,
.generic-cta:hover {
  background-color: #0a0;
  color: #fff;
  filter: drop-shadow(0 0 calc(1.5px * var(--menu-scale)) #66cc66);
}

#game-menu-wrapper button.large.game-start:active,
.generic-cta:active {
  filter: drop-shadow(0 0 calc(0.75px * var(--menu-scale)) #66cc66);
}

#game-menu-wrapper .cta:not(label),
#game-menu-wrapper button.large,
.generic-cta.large {
  border: 1px solid transparent;
  transition: background-color 50ms, color 50ms, filter 50ms, text-shadow 50ms,
    transform 50ms;
}

#game-menu-wrapper button.large:active {
  background-color: (0, 192, 0, 0.25);
  filter: drop-shadow(0 0 1.5px rgba(255, 255, 255, 0.5));
}

#game-menu-wrapper .cta:not(label):active,
#game-menu-wrapper button.large:active,
.generic-cta:active {
  transform: scale3d(0.9, 0.9, 1);
  transform-origin: 50% 50%;
}

@media screen and (orientation: portrait) {
  body.is_iphone #game-menu-wrapper {
    /* tight space on e.g., iPhone in portrait. */
    padding-left: 0;
    padding-right: 0;
  }

  body.is_iphone #game-type-list-wrapper {
    /* drop margins, since this is a single line item on portrait. */
    margin-left: 0;
  }

  /* pull video left on narrow screens, show helicopter on-screen more often. */
  #home-menu-video {
    margin-left: -45%;
  }
}

#network-pipe,
#network-prompt {
  /* prefs panel option: hide until deemed relevant. */
  display: none;
}

#game-options-button .emoji-text {
  position: relative;
  /* ugh, more emoji tweaks. */
  top: calc(1px * var(--menu-scale));
}

#game-buttons .this-rocks {
  position: relative;
  top: -2px;
}

@media screen and (max-width: 900px) and (orientation: portrait) {
  /**
   * Special case: On smaller screens, simplify UI.
   * Hide standalone network button, move into settings.
   */
  #start-network-game {
    /* home screen network menu icon */
    display: none;
  }

  #network-pipe {
    display: inline-block;
    color: #003000;
  }

  #game-options-button {
    /* throw a network icon on here. */
    background-image: url(../image/win95-networking-icon.png);
    background-position: 86% 50%;
    background-size: calc(8px * var(--menu-scale));
    background-repeat: no-repeat;
    /* make room for icon */
    padding-left: calc(4px * var(--menu-scale)) !important;
    padding-right: calc(12px * var(--menu-scale)) !important;
  }

  #game-buttons .this-rocks {
    /* Reduce the size of 🎸🤘 */
    font-size: calc(7.5px * var(--menu-scale));
    vertical-align: bottom;
  }

  body:not(.game-started) #network-prompt {
    /* show the network option in the prefs panel. */
    display: block;
  }
}

.flying-ace {
  background: url(../image/flying_ace.png) 50% 100% / contain no-repeat;
  height: 40.5px;
  /* obligatory: the Flying Ace, on the doghouse. "Snoopy vs. The Red Baron" - from "It's The Great Pumpkin, Charlie Brown!" */
  width: 25px;
}

#domfetti-overlay {
  /* initially hidden, shown only with active explosions */
  display: none;
}

button .network-icon {
  position: relative;
  background: url(../image/win95-networking-icon.png) 0 0 / contain no-repeat;
  display: inline-block;
  width: calc(10px * var(--menu-scale));
  height: calc(10px * var(--menu-scale));
  /* positioning tricks */
  top: calc(1px * var(--menu-scale));
  padding: 3px;
  margin: -6px 0;
}

button .button-icon {
  pointer-events: none;
}

#network-status {
  display: none;
}

#lights {
  display: inline-block;
  width: 16px;
  height: 10px;
  image-rendering: pixelated;
  overflow: hidden;
  position: relative;
  vertical-align: middle;
  /* sneaky scaling shenanigans */
  zoom: calc(1 * var(--gs));
}

#lights .sub-sprite {
  display: block;
  background: url(../image/lights.exe.png) no-repeat;
  width: calc(64px * var(--gs));
  height: calc(10px * var(--gs));
  left: 0;
  opacity: 0.75;
  position: absolute;
  top: 0;
  will-change: transform;
}

.debug-rect:hover {
  background: rgba(0, 0, 0, 0.75);
  outline: #fff solid 1px;
  z-index: 10;
}

#message-box {
  position: absolute;
  top: -1px;
  left: 25%;
  display: none;
  width: 50%;
  height: 14px;
  text-align: center;
  z-index: 2;
}

#message-form {
  display: inline-block;
  width: 50%;
}

#message-form-input {
  background: rgba(0, 0, 0, 0.9);
  border: 0.5px solid #393;
  color: #3c3;
  display: block;
  font-size: calc(7px * var(--gs));
  margin: 0;
  padding: calc(2px * var(--gs));
  text-align: center;
  width: 100%;
}

#message-form-input:focus {
  background-color: #060;
  outline: 0;
}

#message-form-input::placeholder {
  /* https://developer.mozilla.org/en-US/docs/Web/CSS/::placeholder */
  color: #090;
}

ul.inline-list,
ul.inline-list li {
  display: inline-block;
}

ul.inline-list li:not(:first-of-type) {
  margin-left: 0.5em;
}

#battlefield video {
  pointer-events: none;
}

#level-preview {
  height: 100%;
  width: 100%;
}

#level-preview,
.target-dot {
  position: absolute;
  top: 0;
}

/* various cases for disabling scan range UI */
#world.scan_ui_battlefield_enemy_disabled #battlefield .sprite.enemy .scan-node,
#world.scan_ui_battlefield_friendly_disabled
  #battlefield
  .sprite:not(.enemy)
  .scan-node,
#world.scan_ui_radar_enemy_disabled #radar .sprite.enemy .scan-node,
#world.scan_ui_radar_friendly_disabled #radar .sprite:not(.enemy) .scan-node {
  display: none;
}

#letters-from-the-old-tanker,
#battle-over-letter {
  display: none;
}

.landscape-space-portrait-line-break {
  /* hackish: override regular announcement span rules */
  width: 0.25em !important;
  display: inline-block !important;
}

@media screen and (orientation: portrait) {
  .landscape-space-portrait-line-break {
    display: block !important;
    font-size: 0px !important;
    width: 0 !important;
  }
}

span.no-emoji-substitution {
  /* discourage browsers from substituting emoji / ASCII characters, and vice-versa. */
  display: inline;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
    Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  border-left: none;
  border-right: none;
}

#stars {
  position: absolute;
  /* offset for radar */
  top: 8%;
  left: 0;
  width: 100%;
  /* stretch down to bottom bar */
  height: 85.5%;
  opacity: 0;
}

body.loaded #stars {
  transition: opacity 0.75s ease-in-out;
}

body.loaded #stars.fade-in {
  opacity: 1;
}

body.is-mobile .hide-on-mobile,
body.is_iphone .hide-on-iphone {
  display: none;
}

@keyframes noise {
  0% {
    background-position: 0 0;
    transform: translate3d(0, 0, 0);
  }

  to {
    transform: translate3d(500px, 0, 0);
  }
}
